skip: False
name: runAMPL
test: "\n\nTest cases for runAMPL tool"
cwd: ../../dist/bin/
binary_path: ../../dist/bin/runAMPL
#show_results_diff: True

text_output: &TEXT_OUTPUT
  treat_as: text
bytes_output: &BYTES_OUTPUT
  treat_as: bytes
json_output: &JSON_OUTPUT
  treat_as: json


ALL_POSSIBLE_FLAGS:
#  - name: ampl
#    value: <filename>
#  - name: xml-input <xml filename>
#  - name: xml-output <xml filename>
#  - name: json-file <filename>
#  - name: json-output <filename>
#  - name: document-conf <filename> (short -dc)
#  - name: mode redlining/publish
#  - name: redlining
#  - name: output-new-xml
#  - name: db <path>
#  - name: base-db <path>
#  - name: branch <branch-name>
#  - name: orig-branch <branch-name>
#  - name: lawdate <mm/dd/yyyy>
#  - name: amend-date <mm/dd/yyyy>
#  - name: alias <orig> <new>
#  - name: retrieve-xmls


default_parameters: &DEFAULT_TEST_PARAMETERS
  skip: True
  cwd: ../../dist/bin/
  log_file: logs/XMLextract.log

  stdin:
    <<: *BYTES_OUTPUT
    directory: ../AMPL-test2
    file_name: BILLS-116hr1500ih.xml
    treat_as: bytes
  stdout: &STDOUT
    <<: *JSON_OUTPUT
    directory: &RESULT_DIR test_logs/ExtractXML/stdout/
  stderr: &STDERR
    <<: *TEXT_OUTPUT
    directory: &ERR_DIR test_logs/ExtractXML/stderr/
  expected_stdout: &EXPECTED_STDOUT
    <<: *JSON_OUTPUT
    directory: &EXPECTED_RESULTS_DIR test_logs/ExtractXML/
  expected_return_code: 0

tests:
  - <<: *DEFAULT_TEST_PARAMETERS
    skip: False
    test: "* with no flags"
    _file_name: &FILE_NAME 116hr1500ih.json
    flags:
    stdout:
      <<: *STDOUT
      file_name: 116hr1500ih.json
    stderr:
      <<: *STDERR
      file_name: 116hr1500ih.error.log
    expected_stdout:
      <<: *EXPECTED_STDOUT
      file_name: 116hr1500ih.json

  - <<: *DEFAULT_TEST_PARAMETERS
    test: "* with flag: -ag"
    flags:
      - name: ag
    #      - name: amendments
    #      - name: cg
    #      - name: run-cimpl
    #      - name: timeout
    #        value: 2000
    stdout:
      <<: *STDOUT
      file_name: 116hr1500ih-ag.json
    stderr:
      <<: *STDERR
      file_name: 116hr1500ih-ag.error.log
    expected_stdout:
      <<: *EXPECTED_STDOUT
      file_name:  116hr1500ih-ag.json

  - <<: *DEFAULT_TEST_PARAMETERS
    test: "* with flags: -ag, -amendments"
    flags:
      - name: ag
      - name: amendments
    #      - name: cg
    #      - name: run-cimpl
    #      - name: timeout
    #        value: 2000
    stdout:
      <<: *STDOUT
      file_name: 116hr1500ih-ag-amd.json
    stderr:
      <<: *STDERR
      file_name: 116hr1500ih-ag-amd.error.log
    expected_return_code: 0
    expected_stdout:
      <<: *EXPECTED_STDOUT
      file_name: 116hr1500ih-ag-amd.json


  - <<: *DEFAULT_TEST_PARAMETERS
    test: "* with flags: -ag, -cg, -amendments"
    flags:
      - name: ag
      - name: amendments
      - name: cg
    #      - name: run-cimpl
    #      - name: timeout
    #        value: 2000
    stdout:
      <<: *STDOUT
      file_name: 116hr1500ih-ag-cg-amd.json
    #      file_path: test_logs/ExtractXML/out/116hr1500ih-ag.json
    stderr:
      <<: *STDERR
      file_name: 116hr1500ih-ag-cg-amd.error.log
    expected_return_code: 0
    expected_stdout:
      <<: *EXPECTED_STDOUT
      file_name: 116hr1500ih-ag-cg-amd.json

  - <<: *DEFAULT_TEST_PARAMETERS
    test: "* with flags: -ag, -cg, -amendments, -run-cimpl"
    flags:
      - name: ag
      - name: amendments
      - name: cg
      - name: run-cimpl
    #      - name: timeout
    #        value: 2000
    stdout:
      <<: *STDOUT
      file_name: 116hr1500ih-ag-cg-amd-run-cimpl.json
    #      file_path: test_logs/ExtractXML/out/116hr1500ih-ag.json
    stderr:
      <<: *STDERR
      file_name: 116hr1500ih-ag-cg-amd-run-cimpl.error.log
    expected_return_code: 0
    expected_stdout:
      <<: *EXPECTED_STDOUT
      file_name: 116hr1500ih-ag-cg-amd-run-cimpl.json